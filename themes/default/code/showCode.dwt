<!DOCTYPE html>
<html class="dianziquan_1">
	<head>
		<meta charset="UTF-8">
		<title>聚优福利</title>
		<script src="{$app_path}js/juyoufuli/jquery.min.js"></script>
		<script src="{$app_path}js/juyoufuli/jquery.SuperSlide.2.1.1.source.js"></script>
        <script src="{$app_path}js/juyoufuli/stickUp.js"></script>

	</head>

	<body>
		
        <!-- 公用头部 -->
		<!-- #BeginLibraryItem "/library/page_top.lbi" --><!-- #EndLibraryItem -->
        <!-- 头部结束 --> 
        
        <div class="w_1200">       	
			<div class="buy">
				<div class="details_all" style="overflow: hidden;">
				<div class="buy_details f_l">
                        <ul>
                            <li class="shuliang">
                            名称：{$goods.goods_name}
                       		</li>
                            <li class="shuliang">数量：
                            	<div class="quantity ver_bottom">
									<a id="decrement" class="decrement" onclick="del()">-</a>
									<input name="number" id="number" class="itxt" value="1" type="text">
									<a id="increment" class="increment" onclick="add()">+</a>
					    		</div>
                       		</li>
                            <li class="tel">
                                <img src="/images/index/img_login/tel_img.png">
                                <input type="text" name="mobile" id="mobile" class="judgeBound" value="{$usernames.mobile_phone}" placeholder="请输入手机号码">
                            </li>
                        </ul>
                    </div>
                    <div class="buy_tips f_r">
                        <div class="box">
                            该号码为接收电子码短信的手机号码，有效期内可兑换该影院指定类型电影票1张(首映式、明星见面会、vip厅、国
    定节假日和
    特殊节日如情人节,圣诞节,平安夜、不参加早（10:00Q前）、晚（含22:00后）场场次等不可用,特殊影片以影院公告现场补
    差价)打印小
    票仅限当日兑换使用,逾期作废！
                        </div>
                    </div>
				</div>
				<div style="text-align: center;"><span class="buy_btn"><span  class="dzq_lijigoumai"></span>立即购买</span></div>
			</div>
            
            <input type="hidden" name="act" value="orderCode" />
            <input type="hidden" name="price" id="price" value="{$goods.market_price}" />
            <input type="hidden" name="real_price" id="real_price" value="{$goods.shop_price}" />
            
		</div>
        
        <!-- 公用底部 -->
		<!-- #BeginLibraryItem "/library/page_footer.lbi" --><!-- #EndLibraryItem -->
        <!-- 底部结束 -->
        <!-- 公共左边 -->
		<!-- #BeginLibraryItem "/library/page_left.lbi" --><!-- #EndLibraryItem -->
        <!-- 公共左边结束 -->        
        <!-- 公共右边 -->
		<!-- #BeginLibraryItem "/library/page_right.lbi" --><!-- #EndLibraryItem -->
        <!-- 公共右边结束 -->
        
		<script>
		
		var checkSubmitFlg = false;
		
		$('.dianziquan_1 .w_1200 .buy .buy_details li.border_1').click(function(){
			$(this).addClass('active').siblings().removeClass('active');
		})
		
		function changeAttr(obj, id){
			var child = obj.parentNode.children;
			for (var i = 0; i<child.length;i++) {
				if (child[i]){
					if (child[i].className == 'border_1 checked'){
						child[i].className = 'border_1';
						break;
					}
				}
			}
			obj.className = "border_1 checked";
			document.getElementById('TicketNo_'+id).click();
		}
		
		$('.buy_btn').click(function(){
			var number  	= $('input[name=number]').val();
			var price   	= $('#price').val();
			var real_price   	= $('#real_price').val();
			var mobile 		= $('input[name=mobile]').val();

			if(checkSubmitFlg == true){ 
				alert('提交中，请耐心等待！');
				return false;
			}
				
			if( mobble == ''){
				alert('手机号码不能为空!');
				return false;
			}
			if( price == '' || real_price == '' ){
				alert('无法提交！');
				return false;
			}
			
			var params = {mobile:mobble,price:price,number:number};
		
			checkSubmitFlg = true;
		
			$.ajax({
					type:'POST',
					url:'code_order.php?act=orderCode',
					data:params,
					beforeSend:function(){
						$('.buy_btn').text('提交中...');
					},
					success:function(info){
						var data = jQuery.parseJSON(info);
						if(data.error > 0){
							alert(data.message);
							checkSubmitFlg = false;
							$('.buy_btn').text('立即提交');
						}else{
							window.location.href = "movie_order.php?act=payinfoDzq&id="+data.message;
						}
					}
				});

			
		});
	
		function del(){
			var num = document.getElementById("number");
			var n = parseInt(num.value);
			if(n-1<=0){
				num.value = 1;
			}else{
				num.value = n-1;
			}
		}
		function add(){
			var num = document.getElementById("number");
			var n = parseInt(num.value);
			num.value = n+1 > 99 ? 99 : n+1;
		}
		function checkNum(num){
			if (isNaN(num)){
				alert('只能是数字');
				document.getElementById("number").value = 1;
				return false;
			}
			if (num > 99){
				document.getElementById("number").value = 99;
			}else if (num < 1){
				document.getElementById("number").value = 1;
			}
		}

		</script>
        
     </body>
</html>